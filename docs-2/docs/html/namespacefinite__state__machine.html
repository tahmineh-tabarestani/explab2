<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>second_assignment: finite_state_machine Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">second_assignment
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">package contains codes for second assignment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">finite_state_machine Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfinite__state__machine_1_1_g_o___i_n___r_o_o_m.html">GO_IN_ROOM</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfinite__state__machine_1_1_g_o___t_o___c_h_a_r_g_e_r.html">GO_TO_CHARGER</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfinite__state__machine_1_1_i_n_s_p_e_c_t___r_o_o_m.html">INSPECT_ROOM</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfinite__state__machine_1_1_s_e_t_u_p___m_a_p.html">SETUP_MAP</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfinite__state__machine_1_1_w_a_i_t___f_o_r___c_h_a_r_g_i_n_g.html">WAIT_FOR_CHARGING</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a21eaee937b7a6012081083b55d3a1d0c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefinite__state__machine.html#a21eaee937b7a6012081083b55d3a1d0c">room_data</a> (room_id)</td></tr>
<tr class="separator:a21eaee937b7a6012081083b55d3a1d0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ceaffd420f86709d54b564f75b348eb"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefinite__state__machine.html#a1ceaffd420f86709d54b564f75b348eb">room_position</a> (room)</td></tr>
<tr class="separator:a1ceaffd420f86709d54b564f75b348eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dc23b724cffb76ca84571cf329424df"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefinite__state__machine.html#a0dc23b724cffb76ca84571cf329424df">marker_cb</a> (data)</td></tr>
<tr class="separator:a0dc23b724cffb76ca84571cf329424df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01aa4339daa2f1e3525ccdbafd40e30c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefinite__state__machine.html#a01aa4339daa2f1e3525ccdbafd40e30c">go_to</a> (pose)</td></tr>
<tr class="separator:a01aa4339daa2f1e3525ccdbafd40e30c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf99acd000cd9a710af15917e35afbb1"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefinite__state__machine.html#acf99acd000cd9a710af15917e35afbb1">in_target</a> (target_pose)</td></tr>
<tr class="separator:acf99acd000cd9a710af15917e35afbb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41225cd944336f18121ca93d83ca212a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefinite__state__machine.html#a41225cd944336f18121ca93d83ca212a">main</a> ()</td></tr>
<tr class="separator:a41225cd944336f18121ca93d83ca212a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a211526dd32542146dd6be131f8ab254c"><td class="memItemLeft" align="right" valign="top"><a id="a211526dd32542146dd6be131f8ab254c"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>LOG_TAG</b> = anm.NODE_FINITE_STATE_MACHINE</td></tr>
<tr class="separator:a211526dd32542146dd6be131f8ab254c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeee45575bf7a75aad71a2a4ea6140278"><td class="memItemLeft" align="right" valign="top"><a id="aeee45575bf7a75aad71a2a4ea6140278"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>LOOP_TIME</b> = 1</td></tr>
<tr class="separator:aeee45575bf7a75aad71a2a4ea6140278"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ab2a213e2bdda44a8c586c4ba4b5a80"><td class="memItemLeft" align="right" valign="top"><a id="a6ab2a213e2bdda44a8c586c4ba4b5a80"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>OM</b> = None</td></tr>
<tr class="separator:a6ab2a213e2bdda44a8c586c4ba4b5a80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a4c09ab58d7b44a0f35b26201d9fac9"><td class="memItemLeft" align="right" valign="top"><a id="a3a4c09ab58d7b44a0f35b26201d9fac9"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>mutex</b> = None</td></tr>
<tr class="separator:a3a4c09ab58d7b44a0f35b26201d9fac9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1a08e4db82fb6d1f1087805b09a68b8"><td class="memItemLeft" align="right" valign="top"><a id="ac1a08e4db82fb6d1f1087805b09a68b8"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>rooms_id</b> = []</td></tr>
<tr class="separator:ac1a08e4db82fb6d1f1087805b09a68b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98c3fa1eadb873c939e0c177aec9be1b"><td class="memItemLeft" align="right" valign="top"><a id="a98c3fa1eadb873c939e0c177aec9be1b"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>rooms_name</b> = []</td></tr>
<tr class="separator:a98c3fa1eadb873c939e0c177aec9be1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a865adf60f41c44a4d29c20fa562e96eb"><td class="memItemLeft" align="right" valign="top"><a id="a865adf60f41c44a4d29c20fa562e96eb"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>rooms_center</b> = []</td></tr>
<tr class="separator:a865adf60f41c44a4d29c20fa562e96eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b2ef21c5c73f6bced2b7f8ddf816c3e"><td class="memItemLeft" align="right" valign="top"><a id="a9b2ef21c5c73f6bced2b7f8ddf816c3e"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>rooms_connections</b> = []</td></tr>
<tr class="separator:a9b2ef21c5c73f6bced2b7f8ddf816c3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd496e63bc379ee5e75f114c1d7cbf78"><td class="memItemLeft" align="right" valign="top"><a id="acd496e63bc379ee5e75f114c1d7cbf78"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>rooms_doors</b> = []</td></tr>
<tr class="separator:acd496e63bc379ee5e75f114c1d7cbf78"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">.. module:: finite_state_machine
    :platform: Unix
    :synopsis: The Finite State Machine python script in second_assignment package

.. moduleauthor:: Tahmineh Tabarestani &lt;Tahmine.tbi@gmail.com&gt;
Definiton:

    Breifly, finite_state_machine node define 5 task-level architecture for state machine in order to make robot abile to:

        1. *SETUP_MAP:* Detecte marker ID's use ``my_moveit.cpp`` node to move manipulator and add detected room's id into the list of the rooms
        2. *GO_IN_ROOM:* Patrolling the robot in map autonomously using ``move_base`` package and Finding target room via ontology map and control battery level using helper script ``set_object_state.py``.
        3. *INSPECT_ROOM:* Udate ontology map using helper script ``build_ontology_map.py`` and inspect room by camera on manipulator
        4. *GO_TO_CHARGER:* In case battery level lower than thershold
        5. *WAIT_FOR_CHARGING:* After a while machine state changes to the *GO_IN_ROOM*.

Subscribes to:
    /image_id ---&gt; to get rooms information 

Services:

    /room_info ---&gt; uses RoomInformation.srv

    /state/get_pose ---&gt; uses GetPose.srv

 SimpleActionClient:
    /move_base ---&gt; uses MoveBaseAction</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a01aa4339daa2f1e3525ccdbafd40e30c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01aa4339daa2f1e3525ccdbafd40e30c">&#9670;&nbsp;</a></span>go_to()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def finite_state_machine.go_to </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">    Use Simple Action Client to send goal in ``move_base`` node, and gets a target_pose as an argument and sends it as 
    **MoveBaseGoal.msg** to the action server.
    Args:
        pose(Point)
    Returns:
        result(MoveBaseResult.msg)
</pre> 
</div>
</div>
<a id="acf99acd000cd9a710af15917e35afbb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf99acd000cd9a710af15917e35afbb1">&#9670;&nbsp;</a></span>in_target()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def finite_state_machine.in_target </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>target_pose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">This function it's useful just to control if robot reach target postion. Use **GetPose** service to get current postion
of robot and control in function of proximity threshold. In case robot reach target position state of this function
change to *True*.
Args:
    target_pose(Point)

Returns:
    target_reached(Bool)
</pre> 
</div>
</div>
<a id="a41225cd944336f18121ca93d83ca212a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41225cd944336f18121ca93d83ca212a">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def finite_state_machine.main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">The main function to run finite state machine, add state to each contatiner, create and start the introspection server for visualization **smach_ros**, 
initialises the node and takes an instance of ``Build_Ontology_map`` class in the time instance now, defines the subscriner to the ``/image_id`` topic.
</pre> 
</div>
</div>
<a id="a0dc23b724cffb76ca84571cf329424df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dc23b724cffb76ca84571cf329424df">&#9670;&nbsp;</a></span>marker_cb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def finite_state_machine.marker_cb </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">    Marker CallBack function subscribe to ``image_id`` topic. Each time an image ID is obtained 
    through *robot_camera/image_box* it checks if the ID detected already exists or is significant and
    saves it in the following form:
        1. Save value of ``room_id`` detected (the value must be between 11 and 17 otherwise it is an error)
        2. Save name of room detected (i.e. #E, #R1, #R2, #R3, #R4, #C1, #C2)
        3. Save numer of room detected (there are max 7 IDs)
        4. Save ``room_data`` in ``room_info`` list to find out the connections between room, the door assigned to each room,
            and last visited time for each room
    Data about each room updates in the helper scripts build_ontological_map.py
    Args:
        data(int32)
</pre> 
</div>
</div>
<a id="a21eaee937b7a6012081083b55d3a1d0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21eaee937b7a6012081083b55d3a1d0c">&#9670;&nbsp;</a></span>room_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def finite_state_machine.room_data </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>room_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">    room_data function call service **RoomInformation** to get information of each room, use *room_info*.
    Args: 
        room_id(int)
    Returns:
        resp(RoomInformationResponse)
</pre> 
</div>
</div>
<a id="a1ceaffd420f86709d54b564f75b348eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ceaffd420f86709d54b564f75b348eb">&#9670;&nbsp;</a></span>room_position()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def finite_state_machine.room_position </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>room</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Use previous function ``room_data`` to find out center of each room use *room_pose* *x* and *y* position.

Args:
    room(string)
Returns:
    room_pose(Point)
</pre> 
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
