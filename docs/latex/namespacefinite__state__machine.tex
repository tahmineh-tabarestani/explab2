\hypertarget{namespacefinite__state__machine}{}\doxysection{finite\+\_\+state\+\_\+machine Namespace Reference}
\label{namespacefinite__state__machine}\index{finite\_state\_machine@{finite\_state\_machine}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classfinite__state__machine_1_1_g_o___i_n___r_o_o_m}{G\+O\+\_\+\+I\+N\+\_\+\+R\+O\+OM}}
\item 
class \mbox{\hyperlink{classfinite__state__machine_1_1_g_o___t_o___c_h_a_r_g_e_r}{G\+O\+\_\+\+T\+O\+\_\+\+C\+H\+A\+R\+G\+ER}}
\item 
class \mbox{\hyperlink{classfinite__state__machine_1_1_i_n_s_p_e_c_t___r_o_o_m}{I\+N\+S\+P\+E\+C\+T\+\_\+\+R\+O\+OM}}
\item 
class \mbox{\hyperlink{classfinite__state__machine_1_1_s_e_t_u_p___m_a_p}{S\+E\+T\+U\+P\+\_\+\+M\+AP}}
\item 
class \mbox{\hyperlink{classfinite__state__machine_1_1_w_a_i_t___f_o_r___c_h_a_r_g_i_n_g}{W\+A\+I\+T\+\_\+\+F\+O\+R\+\_\+\+C\+H\+A\+R\+G\+I\+NG}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespacefinite__state__machine_a21eaee937b7a6012081083b55d3a1d0c}{room\+\_\+data}} (room\+\_\+id)
\item 
def \mbox{\hyperlink{namespacefinite__state__machine_a1ceaffd420f86709d54b564f75b348eb}{room\+\_\+position}} (room)
\item 
def \mbox{\hyperlink{namespacefinite__state__machine_a0dc23b724cffb76ca84571cf329424df}{marker\+\_\+cb}} (data)
\item 
def \mbox{\hyperlink{namespacefinite__state__machine_a01aa4339daa2f1e3525ccdbafd40e30c}{go\+\_\+to}} (pose)
\item 
def \mbox{\hyperlink{namespacefinite__state__machine_acf99acd000cd9a710af15917e35afbb1}{in\+\_\+target}} (target\+\_\+pose)
\item 
def \mbox{\hyperlink{namespacefinite__state__machine_a41225cd944336f18121ca93d83ca212a}{main}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_a211526dd32542146dd6be131f8ab254c}\label{namespacefinite__state__machine_a211526dd32542146dd6be131f8ab254c}} 
{\bfseries L\+O\+G\+\_\+\+T\+AG} = anm.\+N\+O\+D\+E\+\_\+\+F\+I\+N\+I\+T\+E\+\_\+\+S\+T\+A\+T\+E\+\_\+\+M\+A\+C\+H\+I\+NE
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_aeee45575bf7a75aad71a2a4ea6140278}\label{namespacefinite__state__machine_aeee45575bf7a75aad71a2a4ea6140278}} 
int {\bfseries L\+O\+O\+P\+\_\+\+T\+I\+ME} = 1
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_a6ab2a213e2bdda44a8c586c4ba4b5a80}\label{namespacefinite__state__machine_a6ab2a213e2bdda44a8c586c4ba4b5a80}} 
{\bfseries OM} = None
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_a3a4c09ab58d7b44a0f35b26201d9fac9}\label{namespacefinite__state__machine_a3a4c09ab58d7b44a0f35b26201d9fac9}} 
{\bfseries mutex} = None
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_ac1a08e4db82fb6d1f1087805b09a68b8}\label{namespacefinite__state__machine_ac1a08e4db82fb6d1f1087805b09a68b8}} 
list {\bfseries rooms\+\_\+id} = \mbox{[}$\,$\mbox{]}
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_a98c3fa1eadb873c939e0c177aec9be1b}\label{namespacefinite__state__machine_a98c3fa1eadb873c939e0c177aec9be1b}} 
list {\bfseries rooms\+\_\+name} = \mbox{[}$\,$\mbox{]}
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_a865adf60f41c44a4d29c20fa562e96eb}\label{namespacefinite__state__machine_a865adf60f41c44a4d29c20fa562e96eb}} 
list {\bfseries rooms\+\_\+center} = \mbox{[}$\,$\mbox{]}
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_a9b2ef21c5c73f6bced2b7f8ddf816c3e}\label{namespacefinite__state__machine_a9b2ef21c5c73f6bced2b7f8ddf816c3e}} 
list {\bfseries rooms\+\_\+connections} = \mbox{[}$\,$\mbox{]}
\item 
\mbox{\Hypertarget{namespacefinite__state__machine_acd496e63bc379ee5e75f114c1d7cbf78}\label{namespacefinite__state__machine_acd496e63bc379ee5e75f114c1d7cbf78}} 
list {\bfseries rooms\+\_\+doors} = \mbox{[}$\,$\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}.. module:: finite_state_machine
    :platform: Unix
    :synopsis: The Finite State Machine python script in second_assignment package

.. moduleauthor:: Tahmineh Tabarestani <Tahmine.tbi@gmail.com>
Definiton:

    Breifly, finite_state_machine node define 5 task-level architecture for state machine in order to make robot abile to:

        1. *SETUP_MAP:* Detecte marker ID's use ``my_moveit.cpp`` node to move manipulator and add detected room's id into the list of the rooms
        2. *GO_IN_ROOM:* Patrolling the robot in map autonomously using ``move_base`` package and Finding target room via ontology map and control battery level using helper script ``set_object_state.py``.
        3. *INSPECT_ROOM:* Udate ontology map using helper script ``build_ontology_map.py`` and inspect room by camera on manipulator
        4. *GO_TO_CHARGER:* In case battery level lower than thershold
        5. *WAIT_FOR_CHARGING:* After a while machine state changes to the *GO_IN_ROOM*.

Subscribes to:
    /image_id ---> to get rooms information 

Services:

    /room_info ---> uses RoomInformation.srv

    /state/get_pose ---> uses GetPose.srv

 SimpleActionClient:
    /move_base ---> uses MoveBaseAction\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacefinite__state__machine_a01aa4339daa2f1e3525ccdbafd40e30c}\label{namespacefinite__state__machine_a01aa4339daa2f1e3525ccdbafd40e30c}} 
\index{finite\_state\_machine@{finite\_state\_machine}!go\_to@{go\_to}}
\index{go\_to@{go\_to}!finite\_state\_machine@{finite\_state\_machine}}
\doxysubsubsection{\texorpdfstring{go\_to()}{go\_to()}}
{\footnotesize\ttfamily def finite\+\_\+state\+\_\+machine.\+go\+\_\+to (\begin{DoxyParamCaption}\item[{}]{pose }\end{DoxyParamCaption})}

\begin{DoxyVerb}    Use Simple Action Client to send goal in ``move_base`` node, and gets a target_pose as an argument and sends it as 
    **MoveBaseGoal.msg** to the action server.
    Args:
        pose(Point)
    Returns:
        result(MoveBaseResult.msg)
\end{DoxyVerb}
 \mbox{\Hypertarget{namespacefinite__state__machine_acf99acd000cd9a710af15917e35afbb1}\label{namespacefinite__state__machine_acf99acd000cd9a710af15917e35afbb1}} 
\index{finite\_state\_machine@{finite\_state\_machine}!in\_target@{in\_target}}
\index{in\_target@{in\_target}!finite\_state\_machine@{finite\_state\_machine}}
\doxysubsubsection{\texorpdfstring{in\_target()}{in\_target()}}
{\footnotesize\ttfamily def finite\+\_\+state\+\_\+machine.\+in\+\_\+target (\begin{DoxyParamCaption}\item[{}]{target\+\_\+pose }\end{DoxyParamCaption})}

\begin{DoxyVerb}This function it's useful just to control if robot reach target postion. Use **GetPose** service to get current postion
of robot and control in function of proximity threshold. In case robot reach target position state of this function
change to *True*.
Args:
    target_pose(Point)

Returns:
    target_reached(Bool)
\end{DoxyVerb}
 \mbox{\Hypertarget{namespacefinite__state__machine_a41225cd944336f18121ca93d83ca212a}\label{namespacefinite__state__machine_a41225cd944336f18121ca93d83ca212a}} 
\index{finite\_state\_machine@{finite\_state\_machine}!main@{main}}
\index{main@{main}!finite\_state\_machine@{finite\_state\_machine}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def finite\+\_\+state\+\_\+machine.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}The main function to run finite state machine, add state to each contatiner, create and start the introspection server for visualization **smach_ros**, 
initialises the node and takes an instance of ``Build_Ontology_map`` class in the time instance now, defines the subscriner to the ``/image_id`` topic.
\end{DoxyVerb}
 \mbox{\Hypertarget{namespacefinite__state__machine_a0dc23b724cffb76ca84571cf329424df}\label{namespacefinite__state__machine_a0dc23b724cffb76ca84571cf329424df}} 
\index{finite\_state\_machine@{finite\_state\_machine}!marker\_cb@{marker\_cb}}
\index{marker\_cb@{marker\_cb}!finite\_state\_machine@{finite\_state\_machine}}
\doxysubsubsection{\texorpdfstring{marker\_cb()}{marker\_cb()}}
{\footnotesize\ttfamily def finite\+\_\+state\+\_\+machine.\+marker\+\_\+cb (\begin{DoxyParamCaption}\item[{}]{data }\end{DoxyParamCaption})}

\begin{DoxyVerb}    Marker CallBack function subscribe to ``image_id`` topic. Each time an image ID is obtained 
    through *robot_camera/image_box* it checks if the ID detected already exists or is significant and
    saves it in the following form:
        1. Save value of ``room_id`` detected (the value must be between 11 and 17 otherwise it is an error)
        2. Save name of room detected (i.e. #E, #R1, #R2, #R3, #R4, #C1, #C2)
        3. Save numer of room detected (there are max 7 IDs)
        4. Save ``room_data`` in ``room_info`` list to find out the connections between room, the door assigned to each room,
            and last visited time for each room
    Data about each room updates in the helper scripts build_ontological_map.py
    Args:
        data(int32)
\end{DoxyVerb}
 \mbox{\Hypertarget{namespacefinite__state__machine_a21eaee937b7a6012081083b55d3a1d0c}\label{namespacefinite__state__machine_a21eaee937b7a6012081083b55d3a1d0c}} 
\index{finite\_state\_machine@{finite\_state\_machine}!room\_data@{room\_data}}
\index{room\_data@{room\_data}!finite\_state\_machine@{finite\_state\_machine}}
\doxysubsubsection{\texorpdfstring{room\_data()}{room\_data()}}
{\footnotesize\ttfamily def finite\+\_\+state\+\_\+machine.\+room\+\_\+data (\begin{DoxyParamCaption}\item[{}]{room\+\_\+id }\end{DoxyParamCaption})}

\begin{DoxyVerb}    room_data function call service **RoomInformation** to get information of each room, use *room_info*.
    Args: 
        room_id(int)
    Returns:
        resp(RoomInformationResponse)
\end{DoxyVerb}
 \mbox{\Hypertarget{namespacefinite__state__machine_a1ceaffd420f86709d54b564f75b348eb}\label{namespacefinite__state__machine_a1ceaffd420f86709d54b564f75b348eb}} 
\index{finite\_state\_machine@{finite\_state\_machine}!room\_position@{room\_position}}
\index{room\_position@{room\_position}!finite\_state\_machine@{finite\_state\_machine}}
\doxysubsubsection{\texorpdfstring{room\_position()}{room\_position()}}
{\footnotesize\ttfamily def finite\+\_\+state\+\_\+machine.\+room\+\_\+position (\begin{DoxyParamCaption}\item[{}]{room }\end{DoxyParamCaption})}

\begin{DoxyVerb}Use previous function ``room_data`` to find out center of each room use *room_pose* *x* and *y* position.

Args:
    room(string)
Returns:
    room_pose(Point)
\end{DoxyVerb}
 